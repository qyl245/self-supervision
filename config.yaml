# 数据配置
data:
  knee_pad_root: "data/KneePAD"
  move_port_root: "data/MovePort"
  window_sec: 2.0
  step_sec: 0.5
  target_sr: 500
  batch_size: 32
  max_emg_channels: 16
  max_imu_sensors: 8
  num_workers: 20
  num_jobs: 20
  prefetch_factor: 6
  cache_dir: "cache/preprocessed"
  subject_split_path: "cache/split"
  enable_filtering: true
  normalize: true       # 每通道零均值单位方差
  scale_to_unit: true   # 将分布压到 [-1,1]
  enable_audit: true                # 是否开启 audit
  min_subjects_per_action: 2        # 方法1 过滤标准

# =数据集信息
dataset_info:
  KneePAD:
    original_emg_rate: 1259.259
    original_imu_rate: 148.148
    num_imu_sensors: 8
    num_imu_axes: 6
  MovePort:
    original_emg_rate: 2000
    original_imu_rate: 100
    num_imu_sensors: 6
    num_imu_axes: 6

# 模型配置
model:
  emg:
    num_channels: 16
    embed_dim: 128
    signal_dim: 1
    nhead: 8
    num_transformer_layers: 2
    dropout: 0.1
  imu:
    num_sensors: 8
    num_axes: 6
    embed_dim: 128
    signal_dim: 6
    nhead: 8
    num_transformer_layers: 3
    dropout: 0.1
  fusion:
    embed_dim: 128
    set_encoder_heads: 4
    set_encoder_layers: 2
    fusion_heads: 4
    num_classes: 16

# 训练配置
train:
  num_epochs: 20
  lr: 3e-4
  weight_decay: 1e-5
  domain_loss_weight: 0.5
  use_dynamic_domain_weight: true
  loss_weights_phase1:
    mae_loss: 0.5
    contrastive_loss: 1.0
    order_loss: 0.5
    domain_loss: 1.0
  freeze_epochs: 5
  schedule_type: "staged"
  loss_schedule:
    stage1:
      epochs: 1-20
      w_cross: 0.8
      w_emg: 0.6
      w_imu: 0.6
    stage2:
      epochs: 21-40
      w_cross: 1.0
      w_emg: 0.4
      w_imu: 0.4
    stage3:
      epochs: 41-50
      w_cross: 1.2
      w_emg: 0.3
      w_imu: 0.3
  linear_weights:
    w_cross: { start: 1.0, end: 0.5 }
    w_emg: { start: 0.1, end: 0.5 }
    w_imu: { start: 0.1, end: 0.5 }
  temperature: 0.1
  num_views: 2
  num_chunks: 3     # 顺序预测chunks
  mask_ratio: 0.75  # MAE mask比例
  warmup_epochs: 3  # 加这个配合调度器用
  device: "cuda"
  resume: false
  output_dir: "outputs"